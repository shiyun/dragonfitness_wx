var init=function(){function t(){var t=$.trim(r.val());return!!i.isPhone(t)||!$("body").find(".overLayer").length&&(e.promptLayer({tsinfo:"手机号码格式错误",btxt2:""}),!1)}function n(){var t=$.trim(a.val());return!!i.isSMSCode(t)||!$("body").find(".overLayer").length&&(e.promptLayer({tsinfo:"验证码格式错误",btxt2:""}),!1)}if(!o)var o=new AJAX;if(!i)var i=new Util;if(!e)var e=new UI;var s=$(".btn-sendSms"),r=$("#inpPhone"),a=$("#inpSmsCode"),c=$(".btn-login"),l=$("#token").val(),u=null,f=60,p=i.getQueryString(),v=(p.state,i.authPass());v&&(r.on("blur",t),a.on("blur",n),s.on("click",function(){t()&&o.post(o.api.SENDSMS,{mobilePhone:r.val(),action:"exchange"},function(t){return console.log(t),"1000"!=t.status.code?void e.promptLayer({tsinfo:t.status.desp,btxt2:""}):void("1101"==t.status.code?location.href="/login":(s.prop("disabled",!0),u=setInterval(function(){f--,0==f?(s.prop("disabled",!1).html("重新发送"),f=60,clearInterval(u)):s.html(f+"s")},1e3)))},function(t){e.promptLayer({tsinfo:"发送短信失败",btxt2:""})},{auth:!0})}),c.on("click",function(){t()&&n()&&o.post(o.api.UPDATE_PHONE,{newPhone:r.val(),verifyCode:a.val(),token:l||"ohimWxMQdkMA-fiJrpkGPv4CIU2s"},function(t){console.log("login:"+JSON.stringify(t)),console.log(t),"1000"==t.status.code?e.promptLayer({tsinfo:"更换手机号成功",btxt2:"",successCB:function(){}}):e.promptLayer({tsinfo:t.status.desp,btxt2:"",successCB:function(){}})},function(t){e.promptLayer({tsinfo:"更换手机号失败",btxt2:"",successCB:function(){}})},{auth:!0})}))};$(function(){init&&init()});