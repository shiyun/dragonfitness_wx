var init=function(){function t(t){t.val("").focus()}function n(){s.post(s.api.COUPON_LIST,{token:e},function(t){"1000"==t.status.code?o(t.result.coupons):"1101"==t.status.code?location.href="/login":c.promptLayer({tsinfo:"获取优惠券信息失败",btxt2:""})},function(t){c.promptLayer({tsinfo:"获取优惠券信息失败",btxt2:""})},{auth:!0})}function o(t){if(_.isArray(t)){var n="";_.map(t,function(t,o){var s="",i="";"1,2"==t.scope?(i="q1",s="通用优惠券"):"1"==t.scope?(i="q2",s="入会减免券"):(i="q3",s="会员减免券"),n+='<li class="'+i+'">\t<span class="couponNum">ID:'+t.code+'</span>\t<div class="couponInfo">\t\t<p class="f36 mb5"><span class="bigCouponNum">'+t.amount+'</span>元</p>\t\t<p class="f24 mb10">'+s+'</p>\t</div>\t<p class="expiryDate">有效期至'+t.endTime+"</p>\t</li>"}),$(".list-coupon").html(n)}else c.promptLayer({tsinfo:"优惠券信息错误",btxt2:""})}if(!s)var s=new AJAX;if(!i)var i=new Util;if(!c)var c=new UI;var a=i.authPass();if(a){var p=$(".inp-coupon"),u=$(".btn-coupon"),e=$("#token").val();n(),u.on("click",function(){var o=$.trim(p.val());""==o?c.promptLayer({tsinfo:"请输入您的优惠码",btxt2:"",successCB:function(){t(p)}}):s.post(s.api.COUPON_EXCHANGE,{exchangeNo:o,token:e},function(o){console.log(o),"1000"==o.status.code?c.promptLayer({tsinfo:"兑换成功",btxt2:"",successCB:function(){t(p),n()}}):"1101"==o.status.code?location.href="/login":c.promptLayer({tsinfo:o.status.desp,btxt2:"",successCB:function(){t(p)}})},function(n){c.promptLayer({tsinfo:"兑换失败",btxt2:"",successCB:function(){t(p)}})},{auth:!0})})}};$(function(){init&&init()});