var init=function(){function t(t){t.val("").focus()}function o(){s.post(s.api.COUPON_LIST,{token:e},function(t){"1000"==t.status.code?n(t.result.coupons):"1101"==t.status.code?location.href="/login":"1100"==t.status.code?s.post(s.api.LOGOUT,{},function(t){window.location.reload()},function(t){window.location.reload()}):a.promptLayer({tsinfo:"获取优惠券信息失败",btxt2:""})},function(t){a.promptLayer({tsinfo:"获取优惠券信息失败",btxt2:""})},{auth:!0})}function n(t){if(_.isArray(t)){var o="";_.map(t,function(t,n){var s="",i="";"1,2"==t.scope?(i="q1",s="通用优惠券"):"1"==t.scope?(i="q2",s="入会减免券"):(i="q3",s="会员减免券"),o+='<li class="'+i+'">\t<span class="couponNum">ID:'+t.code+'</span>\t<div class="couponInfo">\t\t<p class="f36 mb5"><span class="bigCouponNum">'+t.amount+'</span>元</p>\t\t<p class="f24 mb10">'+s+'</p>\t</div>\t<p class="expiryDate">有效期至'+t.endTime+"</p>\t</li>"}),$(".list-coupon").html(o)}else a.promptLayer({tsinfo:"优惠券信息错误",btxt2:""})}if(!s)var s=new AJAX;if(!i)var i=new Util;if(!a)var a=new UI;var c=i.authPass();if(c){var p=$(".inp-coupon"),u=$(".btn-coupon"),e=$("#token").val();o(),u.on("click",function(){var n=$.trim(p.val());""==n?a.promptLayer({tsinfo:"请输入您的优惠码",btxt2:"",successCB:function(){t(p)}}):s.post(s.api.COUPON_EXCHANGE,{exchangeNo:n,token:e},function(n){console.log(n),"1000"==n.status.code?a.promptLayer({tsinfo:"兑换成功",btxt2:"",successCB:function(){t(p),o()}}):"1101"==n.status.code?location.href="/login":"1100"==n.status.code?s.post(s.api.LOGOUT,{},function(t){window.location.reload()},function(t){window.location.reload()}):a.promptLayer({tsinfo:n.status.desp,btxt2:"",successCB:function(){t(p)}})},function(o){a.promptLayer({tsinfo:"兑换失败",btxt2:"",successCB:function(){t(p)}})},{auth:!0})})}};$(function(){init&&init()});