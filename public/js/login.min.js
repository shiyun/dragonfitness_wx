var init=function(){function t(){var t=$.trim(s.val());return!!i.isPhone(t)||!$("body").find(".overLayer").length&&(e.promptLayer({tsinfo:"手机号码格式错误",btxt2:""}),!1)}function n(){var t=$.trim(a.val());return!!i.isSMSCode(t)||!$("body").find(".overLayer").length&&(e.promptLayer({tsinfo:"验证码格式错误",btxt2:""}),!1)}if(!o)var o=new AJAX;if(!i)var i=new Util;if(!e)var e=new UI;var r=$(".btn-sendSms"),s=$("#inpPhone"),a=$("#inpSmsCode"),l=$(".btn-login"),c=$("#token").val(),f=null,u=60,p=i.getQueryString(),v=p.state||"/";s.on("blur",t),a.on("blur",n),r.on("click",function(){t()&&o.post(o.api.SENDSMS,{mobilePhone:s.val(),action:"login"},function(t){return console.log(t),"1000"!=t.status.code?void e.promptLayer({tsinfo:t.status.desp,btxt2:""}):(r.prop("disabled",!0),void(f=setInterval(function(){u--,0==u?(r.prop("disabled",!1).html("重新发送"),u=60,clearInterval(f)):r.html(u+"s")},1e3)))},function(t){e.promptLayer({tsinfo:"发送短信失败",btxt2:""})},{auth:!0})}),l.on("click",function(){t()&&n()&&o.post(o.api.LOGIN,{mobilePhone:s.val(),verifyCode:a.val(),token:c||"ohimWxMQdkMA-fiJrpkGPv4CIU2s"},function(t){console.log("login:"+JSON.stringify(t)),console.log(t),"1000"==t.status.code?location.href=v:e.promptLayer({tsinfo:t.status.desp,btxt2:"",successCB:function(){}})},function(t){e.promptLayer({tsinfo:"登录失败",btxt2:"",successCB:function(){}})},{auth:!0})})};$(function(){init&&init()});